---
layout: post
updated: 2012-04-05
alias: /2012/04/string-encoders-now-has-memory-free.html
title: stringencoders now has memory-free query-string tokenizer
---
<a href="http://code.google.com/p/stringencoders/" target="_blank">stringencoders</a> has a new function&nbsp;<span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">modp_qsiter</span> . &nbsp;It's a URL query string tokenizer in C. &nbsp;Why another one? &nbsp;Many libraries have dependencies on a data structures library, a specialized string library or worse do memory allocation for you, typically causing overhead and needless copying. &nbsp;Not this one. &nbsp;It's up to you do make the copy into whatever string library you want, or put it into a STL <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">map&lt;stirng,string&gt;</span> or not (and define behavior when a key is duplicated).<br />
<br />
One a related note,<a href="http://code.google.com/p/stringencoders/source/browse/trunk/src/modp_burl.h" target="_blank"> modp_burl.h</a> also has a new function <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">modp_burl_decode_raw&nbsp;</span><span class="Apple-style-span" style="font-family: inherit;">which is just like </span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">modp_burl_decode</span><span class="Apple-style-span" style="font-family: inherit;"> except that "</span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">+</span><span class="Apple-style-span" style="font-family: inherit;">" is preserved (compare to PHP&nbsp;<a href="http://php.net/manual/en/function.urldecode.php" target="_blank">url decode</a>&nbsp;and&nbsp;<a href="http://www.php.net/manual/en/function.rawurldecode.php" target="_blank">rawurldecode</a>)&nbsp;</span><br />
<br />
More detail are from<span class="Apple-style-span" style="font-family: inherit;"> <a href="http://code.google.com/p/stringencoders/source/browse/trunk/src/modp_qsiter.h" target="_blank">modp_qsiter.h</a>:</span><br />
<br />
<br />
<table id="src_table_0" style="-webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; border-collapse: collapse; font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Lucida Console', monospace; font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; white-space: pre;"><tbody style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">
<tr id="sl_svn269_20" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">/**</span></span></td></tr>
<tr id="sl_svn269_21" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* Query string key value pair iterator. &nbsp;Uses no heap, makes no copy, makes</span></span></td></tr>
<tr id="sl_svn269_22" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp;no modification of input. &nbsp;Think of this as a super-strtok_r. &nbsp;This</span></span></td></tr>
<tr id="sl_svn269_23" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp;also does not do query-string un-escaping.</span></span></td></tr>
<tr id="sl_svn269_24" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;*</span></span></td></tr>
<tr id="sl_svn269_25" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* qsiiter_t qsi;</span></span></td></tr>
<tr id="sl_svn269_26" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* const char* qs = "foo=bar&amp;ding=bar";</span></span></td></tr>
<tr id="sl_svn269_27" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* qsiter_reset(&amp;qsi, qs, strlen(qs));</span></span></td></tr>
<tr id="sl_svn269_28" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* while &nbsp;(qsiter_next(&amp;qsi)) &#123;</span></span></td></tr>
<tr id="sl_svn269_29" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;// we only get start and length of key,value</span></span></td></tr>
<tr id="sl_svn269_30" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;// up to you how to copy it or not, on heap or stack</span></span></td></tr>
<tr id="sl_svn269_31" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;// with strcpy, strncpy, strndup, memcpy, mempcpy, strlcpy, whatever</span></span></td></tr>
<tr id="sl_svn269_32" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;// callers job to alloc/free memory</span></span></td></tr>
<tr id="sl_svn269_33" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;*</span></span></td></tr>
<tr id="sl_svn269_34" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;const char* key = (const char*) malloc(qsi.keylen + 1);</span></span></td></tr>
<tr id="sl_svn269_35" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;strcpy(key, qsi-&gt;key, qsi-&gt;keylen); &nbsp; </span></span></td></tr>
<tr id="sl_svn269_36" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;const char* val = (const char*) malloc(qsi.vallen + 1);</span></span></td></tr>
<tr id="sl_svn269_37" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;strcpy(val, qsi-&gt;val, qsi-&gt;vallen);</span></span></td></tr>
<tr id="sl_svn269_38" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;printf("key = %s, value = %s\n", key, val);</span></span></td></tr>
<tr id="sl_svn269_39" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;free(key);</span></span></td></tr>
<tr id="sl_svn269_40" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &nbsp; &nbsp;free(value);</span></span></td></tr>
<tr id="sl_svn269_41" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* &#125;</span></span></td></tr>
<tr id="sl_svn269_42" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;*</span></span></td></tr>
<tr id="sl_svn269_43" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;* </span></span></td></tr>
<tr id="sl_svn269_44" style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><td class="source" style="font-size: 12px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 4px; padding-right: 0px; padding-top: 0px; vertical-align: top; white-space: pre-wrap;"><span class="com" style="color: #880000;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;*/</span></span></td></tr>
</tbody></table>